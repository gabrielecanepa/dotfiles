#!/bin/sh

node_modules () (
  YELLOW="\e[33m"
  NC="\033[0m"

  case $1 in
    (list)
      echo "Looking for node_modules in your working directory..."
      node_modules=`find $WORKING_DIR -name "node_modules" -type d -prune -print | xargs du -chs | sort -hr`
      if [ $node_modules ]; then
        echo -t $node_modules
      else
        echo -t "Can't find any module in $WORKING_DIR"
      fi
      ;;

    (clear)
      projects_count=`find $WORKING_DIR -name "node_modules" -type d -prune | grep -c /`
      if [ $projects_count -gt 0 ]; then
        echo "${YELLOW}WARNING: this will remove node_modules from $projects_count project`[ $projects_count -gt 1 ] && echo s`$NC"
        printf "Are you sure you want to continue? [yN] "
        read choice
        case $choice in
          (y | Y)
            echo "Removing node_modules from your working directory..."
            find $WORKING_DIR -name "node_modules" -type d -prune -exec rm -rf '{}' +
            echo -t "Modules successfully removed from $WORKING_DIR"
            ;;
          (*) ;;
        esac
      else
        echo "Can't find any module in $WORKING_DIR"
      fi
      ;;

    (*)
      echo "Usage: node_modules <option>\n"
      echo "Options:"
      echo "  list\t	List all the modules installed in your working directory, grouped by folder size"
      echo "  clear\t	Remove all the modules installed in your working directory"
      ;;
  esac
)
