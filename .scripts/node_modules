#!/bin/zsh

node_modules () (
  case $1 in
    (list)
      echo -n "Looking for modules in your working directory..."
      node_modules=`find $WORKING_DIR -name "node_modules" -type d -prune -print | xargs du -chs | sort -hr`
      if [ $node_modules ]; then
        echo -T
        echo -T $node_modules
      else
        echo -T "Can't find any module in your working directory"
      fi
      ;;

    (clear)
      echo -n "Looking for modules in your working directory..."
      projects_count=`find $WORKING_DIR -name "node_modules" -type d -prune | grep -c /`
      if (( $projects_count > 0 )); then
        echo -T
        echo -T -y "WARNING: this will remove the node_modules folder from $projects_count project`(( $projects_count > 0 )) && echo s`"
        printf "Are you sure you want to continue? (y/n [n]) "
        read choice
        if [[ $choice =~ [yY] ]]; then
          echo -n "Removing modules from your working directory..."
          find $WORKING_DIR -name "node_modules" -type d -prune -exec rm -rf '{}' +
          echo -T
          echo -T -g "Modules successfully removed from your working directory"
        fi
      else
        echo "Can't find any module in your working directory"
      fi
      ;;

    (*)
      echo "Usage: node_modules <command>"
      echo
      echo "Commands:"
      echo "  list\t	List all Node modules installed in your working directory, grouped by folder size"
      echo "  clear\t	Remove all Node modules installed in your working directory"
      ;;
  esac
)
