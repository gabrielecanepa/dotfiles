#!/bin/zsh

node_modules () (
  case $1 in
    (list)
      echo "Looking for modules in $WORKING_DIR..."
      node_modules=`find $WORKING_DIR -name "node_modules" -type d -prune -print | xargs du -chs | sort -hr`
      if [ $node_modules ]; then
        echo -T $node_modules
      else
        echo -T "Can't find any module in your working directory"
      fi
      ;;

    (clear)
      projects_count=`find $WORKING_DIR -name "node_modules" -type d -prune | grep -c /`
      if [ $projects_count -gt 0 ]; then
        echo -y "WARNING: this will remove the node_modules folder from $projects_count project`[ $projects_count -gt 1 ] && echo s`"
        printf "Are you sure you want to continue? (y/n [n])"
        read choice
        if [ "$choice" = "y" ]; then
          echo "Removing modules from your working directory..."
          find $WORKING_DIR -name "node_modules" -type d -prune -exec rm -rf '{}' +
          echo -T "Modules successfully removed from $WORKING_DIR"
        fi
      else
        echo "Can't find any module in $WORKING_DIR"
      fi
      ;;

    (*)
      echo "Usage: node_modules <command>"
      echo
      echo "Commands:"
      echo "  list\t	List all Node modules installed in your working directory, grouped by folder size"
      echo "  clear\t	Remove all Node modules installed in your working directory"
      ;;
  esac
)
